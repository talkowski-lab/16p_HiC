---
title: "List Generated Results"
author: "Siddharth Reed"
date: "`r Sys.Date()`"
---

<style type="text/css">
.main-container {
  max-width: 1800px !important;
  margin-left: auto;
  margin-right: auto;
}
</style>

# Dependencies

```{r knitr}
library(knitr)
knitr::opts_chunk$set(
    # message=FALSE,
    # warning=FALSE,
    results='asis',
    dev=c('png', 'pdf', 'svg'),
    dpi=300
)
```
Set up file locations + load dependenies
```{r dependencies}
library(here)
here::i_am('notebooks/list.results.Rmd')
BASE_DIR <- here()
source(file.path(BASE_DIR, 'scripts', 'locations.R'))
source(file.path(SCRIPT_DIR, 'utils.data.R'))
source(file.path(BASE_DIR, 'scripts', 'constants.R'))
source(file.path(SCRIPT_DIR, 'utils.plot.R'))
source(file.path(SCRIPT_DIR, 'utils.qc.R'))
source(file.path(SCRIPT_DIR, 'hicrep', 'utils.hicrep.R'))
source(file.path(SCRIPT_DIR, 'DifferentialContacts', 'utils.multiHiCCompare.R'))
source(file.path(SCRIPT_DIR, 'loops', 'utils.loops.R'))
source(file.path(SCRIPT_DIR, 'TADs', 'utils.TADs.R'))
source(file.path(SCRIPT_DIR, 'TADs', 'utils.TADCompare.R'))
library(tidyverse)
library(kableExtra)
```
Load sample metadata
```{r load_metadata}
style_table <- function(df){
    df %>% 
    pivot_wider(
        names_from=resolution,
        values_from=n
    ) %>% 
    # kbl() %>% 
    knitr::kable() %>%
    # scroll_box() %>% 
    kable_styling(
        font_size=15,
        full_width=TRUE,
        position="center"
    )
}
resolutions <- c(5, 10, 25, 50, 100) * 1e3
sample.metadata.df <- load_sample_metadata()
samples.to.keep <- 
    sample.metadata.df %>%
    filter(Included) %>%
    pull(SampleID)
```

# List results files {.tabset}

## List all cooler files
```{r list_mcool_files}
list_mcool_files() %>%
    filter(SampleID %in% samples.to.keep) %>% 
    cross_join(tibble(resolution=resolutions)) %>% 
    standardize_data_cols() %>% 
    count(
        # isMerged, 
        resolution,
        Edit, Celltype, Genotype
    ) %>% 
    style_table()
```

## List all calculated marginal coverage results

```{r list_sample_coverage}
list_all_coverage_data(resolutions=resolutions) %>% 
    standardize_data_cols() %>% 
    filter(isMerged == 'Individual') %>% 
    count(
        # isMerged,
        weight, resolution, 
        Edit, Celltype, Genotype,
    ) %>% 
    # arrange(desc(isMerged)) %>% 
    style_table()
```

## List all HiCRep results 

```{r list_HiCREP_results}
list_all_hicrep_results_files() %>%
    standardize_data_cols(skip.isMerged=TRUE) %>%
    mutate(window.size=scale_numbers(window.size, force_chr=TRUE)) %>% 
    count(
        is.downsampled, window.size, h,
        resolution,
        isMerged,
        Edit, Celltype, Genotype,
    ) %>% 
    arrange(isMerged) %>% 
    style_table()
```

## List all TAD results

```{r list_TAD_results}
TAD_DIR %>% 
    parse_results_filelist(suffix='-TAD.tsv') %>%
    filter(method != 'cooltools') %>% 
    get_info_from_MatrixIDs(keep_id=FALSE) %>% 
    standardize_data_cols() %>% 
    count(
        # isMerged,
        method, weight,
        resolution,
        Edit, Celltype, Genotype,
    ) %>% 
    style_table()
```

## List all TADCompare results

```{r list_TADCompare_results}
list_all_TADCompare_results() %>% 
    standardize_data_cols() %>% 
    rename_with(~ str_remove(.x, 'Sample.Group.')) %>% 
    count(
        z.thresh, window.size, gap.thresh,
        # TAD.method, TAD.params,
        TAD.method,
        resolution,
        Numerator, Denominator,
    ) %>% 
    style_table()
```

## List all loop results 

```{r list_loop_results}
list_all_cooltools_dots_results() %>% 
    standardize_data_cols() %>% 
    rename_with(~ str_remove(.x, 'Sample.Group.')) %>% 
    count(
        type, weight,
        resolution,
        Edit, Celltype, Genotype,
    ) %>% 
    style_table()
```

## List all multHiCCompare results 

```{r list_multiHiCCompare_results}
list_all_multiHiCCompare_results(
    resolutions=resolutions,
    sample.group.comparisons=NULL
    ) %>% 
    standardize_data_cols() %>% 
    rename_with(~ str_remove(.x, 'Sample.Group.')) %>% 
    count(
        zero.p, A.min,
        resolution,
        Numerator, Denominator,
    ) %>% 
    style_table()
```

